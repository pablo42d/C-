@using System.Data
@model DataTable

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="fas fa-sitemap"></i> Zarzązanie Działami i Stanowiskami</h2>
        <a href="@Url.Action("EdytujDzial", "Administrator")" class="btn btn-success">
            <i class="fas fa-plus"></i> Dodaj Nowy Dział
        </a>
    </div>

    @*Obsuga wyjątków:*@
    <div class="container mt-3">
        @if (TempData["Sukces"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i> @TempData["Sukces"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @if (TempData["Blad"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i> @TempData["Blad"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
    </div>

    @foreach (DataRow dzial in Model.Rows) // Zewnętrzna zmienna: dzial
    {
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    @dzial["NazwaDzialu"]
                    <span class="badge bg-info text-dark">@dzial["SkroconaNazwa"]</span>
                    <span class="badge bg-secondary">ID: @dzial["ID"]</span>
                </h5>

                @*<h5 class="mb-0">@dzial["NazwaDzialu"] <span class="badge bg-secondary">ID: @dzial["ID"]</span></h5>*@

                <div>
                    <a href="@Url.Action("EdytujDzial", "Administrator", new { id = dzial["ID"] })" class="btn btn-sm btn-warning">
                        <i class="fas fa-edit"></i> Edytuj Nazwę
                    </a>
                    <a href="@Url.Action("UsunDzial", "Administrator", new { id = dzial["ID"] })" class="btn btn-sm btn-danger" onclick="return confirm('Czy na pewno usunąć dział?')">
                        <i class="fas fa-trash"></i>
                    </a>
                    <a href="@Url.Action("EdytujStanowisko", "Administrator", new { idDzialu = dzial["ID"] })" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus-circle"></i> Dodaj Stanowisko
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <tbody id="stanowiska-@dzial["ID"]">
                        @{
                            var currentDzialId = Convert.ToInt32(dzial["ID"]);
                            var wszystkieStanowiska = ViewBag.WszystkieStanowiska as DataTable;
                            bool znalezionoStanowisko = false;
                        }

                        @if (wszystkieStanowiska != null)
                        {
                            foreach (DataRow stan in wszystkieStanowiska.Rows) // Zmieniono nazwę na: stan
                            {
                                if (Convert.ToInt32(stan["ID_Dzialu"]) == currentDzialId)
                                {
                                    znalezionoStanowisko = true;
                                    <tr>
                                        <td class="ps-4">@stan["NazwaStanowiska"]</td>
                                        <td class="text-center" style="width: 150px;">
                                            <div class="btn-group">
                                                <a href="@Url.Action("EdytujStanowisko", "Administrator", new { id = stan["ID"] })" class="btn btn-sm btn-outline-warning">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="@Url.Action("UsunStanowisko", "Administrator", new { id = stan["ID"] })" class="btn btn-sm btn-outline-danger" onclick="return confirm('Usunąć stanowisko?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                        }

                        @if (!znalezionoStanowisko)
                        {
                            <tr>
                                <td colspan="2" class="text-center text-muted small py-2">Brak zdefiniowanych stanowisk dla tego działu.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>






@*@using System.Data
    @model DataTable

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2><i class="fas fa-sitemap"></i> Słownik Działów</h2>
            <a href="@Url.Action("EdytujDzial", "Administrator")" class="btn btn-success">
                <i class="fas fa-plus"></i> Dodaj Nowy Dział
            </a>
        </div>

        <div class="table-responsive shadow-sm">
            <table class="table table-bordered table-hover bg-white">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 100px;">ID</th>
                        <th>Nazwa Jednostki / Działu</th>
                        <th class="text-center" style="width: 150px;">Akcje</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (DataRow row in Model.Rows)
                    {
                        <tr>
                            <td>@row["ID"]</td>
                            <td><strong>@row["NazwaDzialu"]</strong></td>
                            <td class="text-center">
                                <a href="@Url.Action("EdytujDzial", "Administrator", new { id = row["ID"] })" class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="mt-3">
            <a href="@Url.Action("Index", "Administrator")" class="btn btn-secondary">Powrót do Dashboardu</a>
        </div>
    </div>*@
